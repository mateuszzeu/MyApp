name: iOS Tests

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  test:
    runs-on: macos-latest

    steps:
      # 1. Pobierz kod z repozytorium
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2. Zainstaluj zależności
      - name: Install dependencies
        run: |
          gem install bundler
          bundle install

      # 3. Resetuj symulatory
      - name: Reset simulators
        run: xcrun simctl shutdown all && xcrun simctl erase all

      # 4. Ustaw Xcode
      - name: Set up Xcode
        uses: maxim-lobanov/setup-xcode@v1
        with:
          xcode-version: 16.1

      # 5. Debuguj konfigurację
      - name: Debug environment
        run: |
          echo "Xcode version:"
          xcodebuild -version
          echo "Available simulators:"
          xcrun simctl list devices

      # 6. Uruchom testy
      - name: Run tests
        run: |
          xcodebuild test \
            -project Stronger.xcodeproj \
            -scheme Stronger \
            -destination 'platform=iOS Simulator,name=iPhone 16 Pro,OS=16.4' \
            -verbose
